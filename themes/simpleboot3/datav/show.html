<html style="overflow-x: hidden; overflow-y: visible">

<head lang="en">
  <meta charset="UTF-8">
  <meta name="renderer" content="webkit">
  <meta name="data-spm" content="datav">
  <title>{$title}</title>

 <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=yarzUUkNb0F0UgHUbSGiHRwQ"></script>

  <link rel="stylesheet" type="text/css" href="__TMPL__/datav/css/show.css" />

  <script src="__TMPL__/datav/js/jquery.js"></script>
  <script src="__TMPL__/datav/js/echarts.js"></script>
</head>
<body onLoad="startTime()">  
<div class="datavLayout">
    <div class="header">
        <div class="head_left">
            <div class="info">
                <div class="icon"></div>
                <span class="date">{$role['name']}&nbsp;&nbsp;:&nbsp;&nbsp;{$admin['user_login']}&nbsp;&nbsp; [&nbsp;&nbsp;<a href="{:url('datav/Public/logout')}">退出</a>&nbsp;&nbsp;]</span>
            </div>
        </div>
        <div class="head_mid">
            <div class="title">{$title}</div>
            <div class="bt"></div>
        </div>
        <div class="head_right">
            <div class="times">
                <div class="icon" width="18px" height="18px" ></div>
                <span class="date" id="ShowTime"></span>
            </div>

        </div>
    </div>
    <div class="wraper"></div>
    <div class="content">
        <div class="cleft">
            <div class="box vw25">
                <div class="title">
                    <div class="icon" width="18px" height="18px" ></div>
                    <span class="text" >平台整体流量数据</span>
                </div>
                <div class="ll_box color_1">
                    <div class="num" id="pv">58,372</div>
                    <span class="text" >平台浏览量(PV)</span>
                </div>
                <div class="ll_box color_2">
                    <div class="num" id="cv">58,372</div>
                    <span class="text" >平台访问次数</span>
                </div>
                <div class="ll_box color_3">
                    <div class="num" id="uv">58,372</div>
                    <span class="text" >平台访客数(UV)</span>
                </div>
                <div class="ll_box color_4">
                    <div class="num" id="ip">58,372</div>
                    <span class="text" >平台IP 数</span>
                </div>
            </div>


            <div class="box vw25">
                <div class="title">
                    <div class="icon" width="18px" height="18px" ></div>
                    <span class="text" >平台当日流量数据</span>

                </div>
                <div id="main2" class="my_main" style="float:left;width: 24vw; height: 10vw;"></div>
              
            </div>

            <div class="box vw25">
                <div class="title">
                    <div class="icon" width="18px" height="18px" ></div>
                    <span class="text" >平台流量数据</span>
                </div>
                <div id="main3" class="my_main" style="float:left;width: 24vw; height: 10vw;"></div>
              
            </div>
            
        </div>


        <div class="cmid">
            <div class="box vw50">
                <div id="allmap" class="vw50_full"></div>
                <div class="maptip2">
                    <div class="m_box color_5">
                        <div class="num">全市：</div>
                        <span class="text" ></span>
                    </div>
                    <div class="m_box color_1">
                        <div class="num">{$jg_num}</div>
                        <span class="text" >服务机构数</span>
                    </div>
                    <div class="m_box color_1">
                        <div class="num">{$cp_num}</div>
                        <span class="text" >服务产品数</span>
                    </div>
                    <div class="m_box color_2">
                        <div class="num">{$qy_num}</div>
                        <span class="text" >注册企业数</span>
                    </div>
                    <div class="m_box color_2">
                        <div class="num">{$fw_num}</div>
                        <span class="text" >企业需求数</span>
                    </div>
                    <div class="m_box color_2">
                        <div class="num">{$dj_num}</div>
                        <span class="text" >需求对接数</span>
                    </div>
                    <div class="m_box color_3">
                        <div class="num">{$lxd_num}</div>
                        <span class="text" >联系点</span>
                    </div>
                    <div class="m_box color_4">
                        <div class="num">{$zj_num}</div>
                        <span class="text" >专家</span>
                    </div>
                </div>
            </div>

            <div class="box vw25_mid">
                <div class="title">
                    <div class="icon" width="18px" height="18px" ></div>
                    <span class="text" >平台流量数据s</span>
                </div>
                <div id="main4" class="my_main" style="float:left;width: 24vw; height: 10vw;"></div>
            </div>

            <div class="box vw25_mid">
                <div class="title">
                    <div class="icon" width="18px" height="18px" ></div>
                    <span class="text" >平台流量数据</span>
                </div>
                <div id="main5" class="my_main" style="float:left;width: 24vw; height: 10vw;"></div> 
            </div>

        </div>


        <div class="cright">

            <div class="box vw25_right">
                <div class="title">
                    <div class="icon" width="18px" height="18px" ></div>
                    <span class="text" >平台流量数据</span>
                </div>
                <div id="main6" class="my_main" style="float:left;width: 24vw; height: 10vw;"></div>
              
            </div>

            <div class="box vw25_right">
                <div class="title">
                    <div class="icon" width="18px" height="18px" ></div>
                    <span class="text" >平台流量数据</span>
                </div>
                <div id="main7" class="my_main" style="float:left;width: 24vw; height: 10vw;"></div>
              
            </div>

            <div class="box vw25_right">
                <div class="title">
                    <div class="icon" width="18px" height="18px" ></div>
                    <span class="text" >高新区项目数据</span>
                </div>
                <div id="main8" class="my_main" style="float:left;width: 24vw; height: 10vw;"></div>
              
            </div>

        </div>
        
    </div>

    <div class="wraper"></div>

</div>


</body>
</html>



<script>
    function startTime()
    {
        var today=new Date()
        var years=today.getFullYear();
        var months=today.getMonth();
        var d=today.getDate()
        var h=today.getHours()
        var m=today.getMinutes()
        var s=today.getSeconds()
        // add a zero in front of numbers<10
        months=months+1
        months=checkTime(months)
        d=checkTime(d)
        m=checkTime(m)
        s=checkTime(s)
        var weekday=new Array(7)
        weekday[0]="星期日"
        weekday[1]="星期一"
        weekday[2]="星期二"
        weekday[3]="星期三"
        weekday[4]="星期四"
        weekday[5]="星期五"
        weekday[6]="星期六"
        var w=weekday[today.getDay()]
        document.getElementById('ShowTime').innerHTML=years+"-"+months+"-"+d+"  "+w+" "+h+":"+m+":"+s;
        t=setTimeout('startTime()',500)
    }
    function checkTime(i)
    {
        if (i<10)
        {i="0" + i}
        return i
    }




    // $(function(){

    //     var app_id ='500554165';
    //     var end_date ='2017-12-06';
    //     var start_date ='2017-11-01';
    //     var idx ='10201,10202,10203';
    
    //     var sign ='{$sign}';
    //     $.ajax({
    //         type: "get",
    //         url: "http://mta.qq.com/h5/api/ctr_user_realtime?app_id=500554165&end_date=2017-12-06&idx=10201%2C10202%2C10203&start_date=2017-11-01&sign=0e9bcad9e694b83a22512510a4b5a9d7",
          
    //         dataType:"jsonp",
    //         success: function(result){
    //             alert(1);
    //             writeObj(result);
    //         },
    //         error: function(result){
    //             //请求失败之后的操作
    //             alert(2);
    //             writeObj(result);
    //         }
    //     });
    // })


    function writeObj(obj){ 
     var description = ""; 
     for(var i in obj){ 
     var property=obj[i]; 
     description+=i+" = "+property+"\n"; 
     } 
     alert(description); 
    } 

</script>


<script type="text/javascript">



$.ajax({
    type: "POST",
    url: "{:url('datav/api/tongji',array('type'=>5))}",
    dataType:"json",
    success: function(result){
        var myChart2 = echarts.init(document.getElementById('main2'));
        var tongji = result['body']['data'][0]['result']['pageSum'][0];

        var option = {
            tooltip : {
                trigger: 'item',
                confine: true,
                formatter: "{b} : {c} ({d}%)"
            },
            series: {
                type: 'pie',
                radius: '55%',
                data: [
                    {value:tongji[0], name:'浏览量(PV)'},
                    {value:tongji[1], name:'访问次数'},
                    {value:tongji[2], name:'访客数(UV)'},
                    {value:tongji[3], name:'IP数'}
                ],
                roseType: 'angle',
                itemStyle: {
                    normal: {
                        shadowBlur: 200,
                        shadowColor: 'rgba(0, 0, 0, 0.5)'
                    }
                }
            }
        };

        myChart2.setOption(option);
    },
    error:function(result){
        alert('获取平台流量失败！请重试！')
    }
});


        var myChart3 = echarts.init(document.getElementById('main3'));
        var myChart4 = echarts.init(document.getElementById('main4'));
        var myChart5 = echarts.init(document.getElementById('main5'));
        var myChart6 = echarts.init(document.getElementById('main6'));
        var myChart7 = echarts.init(document.getElementById('main7'));
        var myChart8 = echarts.init(document.getElementById('main8'));


        var fwxqname = new Array();
        var ddcoun = new Array();
        var zzcoun = new Array();
        var wccoun = new Array();
        $.ajax({
            type: "POST",
            url: '/datav/Api/xq',
            async: false,
            cache: false,
            success: function(data) {
                for (var i = 0; i < data.length; i++) {
                    fwxqname[i] = data[i].fwxqname;

                    ddcoun[i] = data[i].ddcoun;

                    zzcoun[i] = data[i].zzcoun;

                    wccoun[i] = data[i].wccoun;

                }
            }
        })

        var option3 = {
            tooltip: {
                trigger: 'axis',
                axisPointer: {
                    lineStyle: {
                        color: '#57617B'
                    }
                }
            },
            grid: {
                left: '3%',
                right: '4%',
                top: '20%',
                bottom: '3%',
                containLabel: true
            },
            xAxis: [{
                type: 'category',
                boundaryGap: false,
                axisLine: {
                    lineStyle: {
                        color: '#57617B'
                    }
                },
                data: fwxqname
            },
            {
                axisPointer: {
                    show: false
                },
                axisLine: {
                    lineStyle: {
                        color: '#57617B'
                    }
                },
                axisTick: {
                    show: false
                },

                position: 'bottom',
                offset: 20
            }],
            yAxis: [{
                type: 'value',
                axisTick: {
                    show: false
                },
                axisLine: {
                    lineStyle: {
                        color: '#57617B'
                    }
                },
                axisLabel: {
                    margin: 8,
                    textStyle: {
                        fontSize: 16
                    }
                },
                splitLine: {
                    lineStyle: {
                        color: '#57617B'
                    }
                },
                splitNumber: 3,
                max: '10',
                min: '1'
            }],
            series: [{
                name: '等待对接',
                type: 'line',
                smooth: true,
                symbol: 'circle',
                symbolSize: 5,
                showSymbol: false,
                lineStyle: {
                    normal: {
                        width: 1
                    }
                },
                areaStyle: {
                    normal: {
                        color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{
                            offset: 0,
                            color: 'rgba(137, 189, 27, 0.3)'
                        },
                        {
                            offset: 0.8,
                            color: 'rgba(137, 189, 27, 0)'
                        }], false),
                        shadowColor: 'rgba(0, 0, 0, 0.1)',
                        shadowBlur: 10
                    }
                },
                itemStyle: {
                    normal: {
                        color: 'rgb(137,189,27)',
                        borderColor: 'rgba(137,189,2,0.27)',
                        borderWidth: 12

                    }
                },
                data: ddcoun
            },
            {
                name: '正在对接',
                type: 'line',
                smooth: true,
                symbol: 'circle',
                symbolSize: 5,
                showSymbol: false,
                lineStyle: {
                    normal: {
                        width: 1
                    }
                },
                areaStyle: {
                    normal: {
                        color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{
                            offset: 0,
                            color: 'rgba(0, 136, 212, 0.3)'
                        },
                        {
                            offset: 0.8,
                            color: 'rgba(0, 136, 212, 0)'
                        }], false),
                        shadowColor: 'rgba(0, 0, 0, 0.1)',
                        shadowBlur: 10
                    }
                },
                itemStyle: {
                    normal: {
                        color: 'rgb(0,136,212)',
                        borderColor: 'rgba(0,136,212,0.2)',
                        borderWidth: 12

                    }
                },
                data: zzcoun
            },
            {
                name: '对接完成',
                type: 'line',
                smooth: true,
                symbol: 'circle',
                symbolSize: 5,
                showSymbol: false,
                lineStyle: {
                    normal: {
                        width: 1
                    }
                },
                areaStyle: {
                    normal: {
                        color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{
                            offset: 0,
                            color: 'rgba(219, 50, 51, 0.3)'
                        },
                        {
                            offset: 0.8,
                            color: 'rgba(219, 50, 51, 0)'
                        }], false),
                        shadowColor: 'rgba(0, 0, 0, 0.1)',
                        shadowBlur: 10
                    }
                },
                itemStyle: {
                    normal: {

                        color: 'rgb(219,50,51)',
                        borderColor: 'rgba(219,50,51,0.2)',
                        borderWidth: 12
                    }
                },
                data: wccoun
            },
            ]
        };


        var fwname = new Array();
        var cpcoun = new Array();
            $.ajax({
                type: "POST",
                url:'/datav/Api/cp',
                async: false,
                cache: false,
                success: function (data) {               
                  for (var i = 0; i < data.length; i++) {
                      fwname[i]=data[i].fwname;
                      cpcoun[i]=data[i].cpcoun;                   
                  }
                }
            })

        //data
        var data = cpcoun;
        var markLineData = [];
        for (var i = 1; i < data.length; i++) {
            markLineData.push([{
                xAxis: i - 1,
                yAxis: data[i - 1],
                value: (data[i] + data[i-1]).toFixed(2)
            }, {
                xAxis: i,
                yAxis: data[i]
            }]);
        }
            
        //option
        var option4 = {
   
            tooltip : {
                trigger: 'axis'
            }, 
            grid: {
                left: '3%',
                right: '4%',
                top:'20%',
                bottom: '3%',
                containLabel: true
            },   
            xAxis: {
                data: fwname
            },
            yAxis: {
                splitNumber : 3,
                max : '50',
                min : '1'
            },
            series: [{
                type: 'line',
                data:data,
                markPoint: {
                    data: [
                        {type: 'max', name: '最大值'},
                        {type: 'min', name: '最小值'}
                    ]
                },
                markLine: {
                    smooth: true,
                            effect: {
                                show: true
                            },
                            distance: 10,
                    label: {
                        normal: {
                            position: 'middle'
                        }
                    },
                    symbol: ['none', 'none'],
                    data: markLineData
                }
            }]
        };


        var option5 = {
            tooltip : {
                trigger: 'axis',
                axisPointer : {            // 坐标轴指示器，坐标轴触发有效
                    type : 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
                }
            },
            grid: {
                left: '3%',
                right: '4%',
                bottom: '5%',
                containLabel: true
            },
            xAxis : [
                {
                    type : 'category',
                    data : ['1月', '2月', '3月', '4月', '5月','6月' ],
                    axisTick: {
                        show:false,
                        alignWithLabel: false
                    },
                    axisLabel:{
                        show:false,
                    },
                     axisLine: {
                        show:false,
                    },
                    
                }
            ],
            yAxis : [
                {
                    show:false,
                    type : 'value'
                }
            ],
            series : [
                {
                    name:'直接访问',
                    type:'bar',
                    barWidth: '30%',
                    label:{
                      normal:{
                          show:true,
                          position:'bottom',
                          formatter:'{c}% \n{b}',
                          textStyle:{
                              color:'#666'
                          }
                      }  
                    },
                    itemStyle:{
                      normal:{
                          barBorderRadius:100,
                          color:function(idx) {
                              console.log(idx)
                              var color = ['#dc4e54','#db8258','#eda350','#a6a34b','#84aa6d','#84abab']
                              return color[idx.dataIndex % color.length]
                          }
                      }  
                    },
                    data:[31, 28, 28, 26, 21,25]
                }
            ]
        };

        

        var time = new Array();
            var cgcoundj = new Array();
            var jjcoundj = new Array();
            var wccoundj = new Array();
            $.ajax({
                type: "POST",
                url:'/datav/Api/dj',
                async: false,
                cache: false,
                success: function (data) {            
                  for (var i = 0; i < data.length; i++) {
                            time[i]=data[i].time;
                            cgcoundj.push({
                                name : '',
                                value : data[i].cgcoundj
                            })
                            jjcoundj.push({
                                name : '',
                                value : data[i].jjcoundj
                            })
                            wccoundj.push({
                                name : '',
                                value : data[i].wccoundj
                            })
                   
                  }
                }
            })
        var color = '#189cbb';
        var lineColor = '#0a324b'
        var xAxisData = time;
        // var seriesData = [45, 55, 70, 95, 55, 70, 85];
        var scale = 1;

        var maxData = '55%';

        var option6 = {
            tooltip: {
                show: true, //去除面板显示
                trigger: 'axis',
                axisPointer: {
                    type: 'cross',
                    label: {
                        backgroundColor: '#185164'
                    }
                }
            },
            legend: {
                show: true,
                itemGap:20,
                data: ['成功受理', '拒绝受理','对接完成'],
                icon: 'circle',
                textStyle: {
                    color: '#3dd3f8',
                    fontSize:10*scale
                },
            },
          
            color: ['#295beb', '#eb297d','#ffc72b'], //3dd3f8
            grid: {
                left: '3%',
                right: '10%',
                top:'30%',
                bottom: '3%',
                containLabel: true
            },
            xAxis: {
                type: 'category',
                boundaryGap: false,
                axisLabel: {
                    textStyle: {
                        color: color,
                        fontSize: 16*scale,
                    }
                },
                axisLine: {
                    lineStyle: {
                        color: lineColor,
                    }
                },
            
                data: xAxisData
            },
            yAxis: {
                type: 'value',
                max: 10,
                axisLabel: {
                    padding: [0, 15, 0, 0],
                    textStyle: {
                        color: color,
                        fontSize: 16*scale,
                    }
                },
                axisLine: {
                    lineStyle: {
                        color: lineColor,
                    }
                },
                splitLine: {
                    show: false
                },
               
         
            },
            series: [{
                name: '成功受理',
                type: 'line',
                stack: '总量',
                smooth: true, //这句就是让曲线变平滑的
                data: cgcoundj,
                symbol: 'none', //拐点样式
             
            }, {
                name: '拒绝受理',
                type: 'line',
                smooth: true, //这句就是让曲线变平滑的
                data: jjcoundj,
                symbol: 'none', //拐点样式
            
            },
            {
                name: '对接完成',
                type: 'line',
                smooth: true, //这句就是让曲线变平滑的
                data: wccoundj,
                symbol: 'none', //拐点样式
            
            }]
        };

        var option7 = {
                      
                         
                            tooltip : {
                                trigger: 'item',
                                formatter: "{a} <br/>{b} : {c} ({d}%)"
                            },
                            legend: {
                                show : false,
                                orient : 'vertical',
                                x : 'left',
                                data:['准会员','普通会员','高级会员','VIP会员','超级VIP会员']
                            },
                            toolbox: {
                                show : false,
                                feature : {
                                    mark : {show: false},
                                    dataView : {show: true, readOnly: false},

                                    restore : {show: true},
                                    saveAsImage : {show: true}
                                }
                            },
                            calculable : false,
                            series : [

                                {
                                    name:'级别占比',
                                    selectedMode: 'single',
                                    type:'pie',
                                    radius : [50, 35],

                                    // for funnel
                                    x: '50%',
                                    width: '35%',
                                    funnelAlign: 'left',

                                    data:[
                                        {value:335, name:'准会员'},
                                        {value:310, name:'普通会员'},
                                        {value:234, name:'高级会员'},
                                        {value:234, name:'VIP会员'},
                                        {value:234, name:'超级VIP会员'}
                                    ]
                                }
                            ]
                        };
        


        var option8 = {
                   
                    title: {
                        text: '多雷达图'
                    },
                    tooltip: {
                        trigger: 'axis'
                    },
                    legend: {
                        x: 'center',
                        data: ['某软件', '某主食手机', '某水果手机', '降水量', '蒸发量']
                    },
                    radar: [

                        {
                            indicator: [{
                                text: '外观',
                                max: 100
                            }, {
                                text: '拍照',
                                max: 100
                            }, {
                                text: '系统',
                                max: 100
                            }, {
                                text: '性能',
                                max: 100
                            }, {
                                text: '屏幕',
                                max: 100
                            }],
                            radius: 40,
                            center: ['50%', '60%'],
                        }
                    ],
                    series: [

                        {
                            type: 'radar',
                            radarIndex: 0,
                            symbol: 'arrow',
                            label: {
                                normal: {
                                    show: true,
                                    formatter: function(params) {
                                        console.log(params);
                                    }
                                }
                            },
                            data: [
                                [0, 12, 34, 55],
                                [1, 45, 56, 66, 78]
                            ]

                        }
                    ]
                }


$.ajax({
    type: "POST",
    url: "{:url('datav/api/xm')}",
    dataType:"json",
    success: function(result){

        var myChart8 = echarts.init(document.getElementById('main8'));
        var xm = result[0];
        var option = {
                    tooltip: {
                        trigger: 'axis',
                        axisPointer: {
                            type: 'none'
                        },
                        formatter: function (params) {
                            return params[0].name + ': ' + params[0].value;
                        }
                    },
                    xAxis: {
                        data: ['在谈', '新签约', '拟开工', '新开工', '在建', '重点', '新投产'],

                        axisTick: {show: false},
                        axisLine: {show: false},
                        axisLabel: {
                            interval: 0,
                            textStyle: {
                                color: '#e54027'
                            }
                        }
                    },
                    yAxis: {
                        splitNumber : 5,
                        max : 'dataMax',
                        min : '0',
                        splitLine: {show: false},
                        axisTick: {show: false},
                        axisLine: {show: false},
                        axisLabel: {show: false}
                    },


                    grid: {
                        left: '3%',
                        right: '4%',
                        top:'20%',
                        bottom: '3%',
                        containLabel: true
                    },   

                    color: ['#e54027'],
                    series: [{
                        name: 'hill',
                        type: 'pictorialBar',
                        barCategoryGap: '-130%',
                        //symbol: 'path://M0,5 L10,0 L5,10 L0,10 z',
                        symbol: 'path://M0,10 L10,10 C5.5,10 5.5,5 5,0 C4.5,5 4.5,10 0,10 z',
                        itemStyle: {
                            normal: {
                                opacity: 0.5
                            },
                            emphasis: {
                                opacity: 1
                            }
                        },
                        data: [xm.zt, xm.xq, xm.nkg, xm.xkg, xm.zj, xm.zd, xm.tc],
                        z: 10
                    }, {
                        name: 'glyph',
                        type: 'pictorialBar',
                        barGap: '-100%',
                        symbolPosition: 'end',
                        symbolSize: 10,
                        symbolOffset: [0, '-120%'],
                        data: [xm.zt, xm.xq, xm.nkg, xm.xkg, xm.zj, xm.zd, xm.tc],
                    }]
        };

        myChart8.setOption(option);
    },
    error:function(result){
        alert('获取平台流量失败！请重试！')
    }
});


        

        myChart3.setOption(option3);
        myChart4.setOption(option4);
        myChart5.setOption(option5);
        myChart6.setOption(option6);
        myChart7.setOption(option7);
        //myChart8.setOption(option9);
        

        
</script>

<script type="text/javascript">
    // 百度地图API功能
    // var map = new BMap.Map("allmap");
    // var point = new BMap.Point(116.404, 39.915);
    // map.centerAndZoom(point, 15);
    
    // //创建小狐狸
    // var pt = new BMap.Point(116.417, 39.909);
    // var myIcon = new BMap.Icon("__TMPL__/datav/images/q.png", new BMap.Size(300,157));
    // var marker2 = new BMap.Marker(pt,{icon:myIcon});  // 创建标注
    // map.addOverlay(marker2);              // 将标注添加到地图中
    // map.enableScrollWheelZoom(true);      //地图缩放
    // map.setMapStyle({style:'bluish'});  
</script>


<script type="text/javascript">

$.ajax({
    type: "POST",
    url: "{:url('datav/api/sdmap')}",
    dataType:"json",
    success: function(result){
        if (result) {
            
            var myChart = echarts.init(document.getElementById('allmap'));
            var uploadedDataURL = "__TMPL__/datav/js/czs.json";
            myChart.showLoading();
            $.getJSON(uploadedDataURL, function(geoJson) {
                echarts.registerMap('changzhi', geoJson);
                myChart.hideLoading();

                var geoCoordMap = {
                    "城区": [113.123088, 36.20353],
                    "长治县": [113.051407, 36.052858],
                    "襄垣县": [113.051491, 36.535817],
                    "屯留县": [112.891998, 36.315663],
                    "郊区": [113.101211, 36.218388],
                    "平顺县": [113.435961, 36.200179],
                    "黎城县": [113.387155, 36.502328],
                    "长子县": [112.8779, 36.122334],
                    "壶关县": [113.207049, 36.115448],
                    "武乡县": [112.864561, 36.837625],
                    "沁县": [112.699226, 36.756063],
                    "沁源县": [112.337446, 36.5002],
                    "潞城市": [113.228852, 36.334104],
                }
                

                var data = result;

        

                
                var max = 199, min = 9; // todo 
                var maxSize4Pin = 100, minSize4Pin = 20;

                var convertData = function (data) {

                    var res = [];
                    for (var i = 0; i < data.length; i++) {
                        var geoCoord = geoCoordMap[data[i].name];
                        if (geoCoord) {
                            res.push({
                                name: data[i].name,
                                value: geoCoord.concat(data[i]['value']),
                            });
                        }
                    }
                    return res;
                };

                var convertData2 = function (data) {

                    var res = [];
                    for (var i = 0; i < data.length; i++) {
                        var geoCoord = geoCoordMap[data[i].name];
                        if (geoCoord) {
                            res.push({
                                name:  geoCoord.concat(data[i]['value']),
                                value: geoCoord.concat(data[i]['value'].qynum+data[i]['value'].jgnum+data[i]['value'].lxdnum+data[i]['value'].fwnum+data[i]['value'].cpnum),
                            });
                        }
                    }
                    return res;
                };

                var option_map = {
                    title: {
                        text: '“公共服务数据”',
                        subtext: '',
                        x: 'center',
                        textStyle: {
                            color: '#ccc'
                        }
                    },
                    tooltip: {
                        trigger: 'item',
                        alwaysShowContent:true,
                        backgroundColor:"",
                        borderColor:"",
                        position: [10, 10],

                        extraCssText: 'width:100%;height:90%;',

                        formatter: function (params) {
                            var data = params['data']['value'];
                            var hstr="";
                          if(typeof(data.name) != "undefined"){
                            hstr +='<div class="maptip">';

                            hstr +='<div class="sm_box color_5">';
                            hstr +='<div class="num">'+data.name + '：</div>';
                            hstr +='<span class="text" ></span>';
                            hstr +='</div>';

                            hstr +='<div class="sm_box color_1">';
                            hstr +='    <div class="num">'+data.jgnum + '</div>';
                            hstr +='    <span class="text" >服务机构数</span>';
                            hstr +='</div>';

                            hstr +='<div class="sm_box color_1">';
                            hstr +='    <div class="num">'+data.cpnum + '</div>';
                            hstr +='    <span class="text" >服务产品数</span>';
                            hstr +='</div>';
                            
                            hstr +='<div class="sm_box color_2">';
                            hstr +='    <div class="num">'+data.qynum + '</div>';
                            hstr +='    <span class="text" >注册企业数</span>';
                            hstr +='</div>';

                            hstr +='<div class="sm_box color_2">';
                            hstr +='    <div class="num">'+data.fwnum + '</div>';
                            hstr +='    <span class="text" >企业需求数</span>';
                            hstr +='</div>';
                            

                            
                            hstr +='<div class="sm_box color_3">';
                            hstr +='    <div class="num">'+data.lxdnum + '</div>';
                            hstr +='    <span class="text" >联系点</span>';
                            hstr +='</div>';

                            hstr +='</div>';

                            return hstr;
                          }else{
                       
                            var data = params['data']['name'][2];

                            if(typeof(data.name) != "undefined"){
                                hstr +='<div class="maptip">';

                                hstr +='<div class="sm_box color_5">';
                                hstr +='<div class="num">'+data.name + '：</div>';
                                hstr +='<span class="text" ></span>';
                                hstr +='</div>';

                                hstr +='<div class="sm_box color_1">';
                                hstr +='    <div class="num">'+data.jgnum + '</div>';
                                hstr +='    <span class="text" >服务机构数</span>';
                                hstr +='</div>';

                                hstr +='<div class="sm_box color_1">';
                                hstr +='    <div class="num">'+data.cpnum + '</div>';
                                hstr +='    <span class="text" >服务产品数</span>';
                                hstr +='</div>';
                                
                                hstr +='<div class="sm_box color_2">';
                                hstr +='    <div class="num">'+data.qynum + '</div>';
                                hstr +='    <span class="text" >注册企业数</span>';
                                hstr +='</div>';

                                hstr +='<div class="sm_box color_2">';
                                hstr +='    <div class="num">'+data.fwnum + '</div>';
                                hstr +='    <span class="text" >企业需求数</span>';
                                hstr +='</div>';
                                

                                
                                hstr +='<div class="sm_box color_3">';
                                hstr +='    <div class="num">'+data.lxdnum + '</div>';
                                hstr +='    <span class="text" >联系点</span>';
                                hstr +='</div>';

                                hstr +='</div>';

                                return hstr;
                            }else{
                                var data = params['value'][2];
                                hstr +='<div class="maptip">';

                                hstr +='<div class="sm_box color_5">';
                                hstr +='<div class="num">'+data.name + '：</div>';
                                hstr +='<span class="text" ></span>';
                                hstr +='</div>';

                                hstr +='<div class="sm_box color_1">';
                                hstr +='    <div class="num">'+data.jgnum + '</div>';
                                hstr +='    <span class="text" >服务机构数</span>';
                                hstr +='</div>';

                                hstr +='<div class="sm_box color_1">';
                                hstr +='    <div class="num">'+data.cpnum + '</div>';
                                hstr +='    <span class="text" >服务产品数</span>';
                                hstr +='</div>';
                                
                                hstr +='<div class="sm_box color_2">';
                                hstr +='    <div class="num">'+data.qynum + '</div>';
                                hstr +='    <span class="text" >注册企业数</span>';
                                hstr +='</div>';

                                hstr +='<div class="sm_box color_2">';
                                hstr +='    <div class="num">'+data.fwnum + '</div>';
                                hstr +='    <span class="text" >企业需求数</span>';
                                hstr +='</div>';
                                

                                
                                hstr +='<div class="sm_box color_3">';
                                hstr +='    <div class="num">'+data.lxdnum + '</div>';
                                hstr +='    <span class="text" >联系点</span>';
                                hstr +='</div>';

                                hstr +='</div>';

                                return hstr;
                            }
                          }
                        },

                    },

                    legend: {
                        orient: 'vertical',
                        y: 'bottom',
                        x: 'right',
                        data: ['credit_pm2.5'],
                        textStyle: {
                            color: '#fff'
                        }
                    },

                    visualMap: {
                        show: false,
                        min: 0,
                        max: 500,
                        left: 'left',
                        top: 'bottom',
                        text: ['高', '低'], // 文本，默认为数值文本
                        calculable: true,
                        seriesIndex: [1],
                        inRange: {
                            // color: ['#3B5077', '#031525'] // 蓝黑
                            // color: ['#ffc0cb', '#800080'] // 红紫
                            // color: ['#3C3B3F', '#605C3C'] // 黑绿
                            color: ['#0f0c29', '#302b63', '#24243e'] // 黑紫黑
                            // color: ['#23074d', '#cc5333'] // 紫红
                            // color: ['#00467F', '#A5CC82'] // 蓝绿
                            // color: ['#1488CC', '#2B32B2'] // 浅蓝
                            // color: ['#00467F', '#A5CC82'] // 蓝绿
                            // color: ['#00467F', '#A5CC82'] // 蓝绿
                            // color: ['#00467F', '#A5CC82'] // 蓝绿
                            // color: ['#00467F', '#A5CC82'] // 蓝绿

                        }
                    },

                    geo: {
                        show: true,
                        map: 'changzhi',
                        label: {
                            normal: {
                                show: false
                            },
                            emphasis: {
                                show: false,
                            }
                        },
                        roam: false,
                        itemStyle: {
                            normal: {
                                areaColor: '#031525',
                                borderColor: '#3B5077',
                            },
                            emphasis: {
                                areaColor: '#2B91B7',
                            }
                        }
                    },
                    series : [
                    {
                            name: 'TOP5',
                            type: 'scatter',
                            coordinateSystem: 'geo',
                            data: convertData(data),
                            symbolSize: function (val) {
                                return (val[2].qynum+val[2].jgnum+val[2].lxdnum+val[2].fwnum+val[2].cpnum) * 1;
                            },
                            label: {
                                normal: {
                                    formatter: '{b}',
                                    position: 'right',
                                    show: true
                                },
                                emphasis: {
                                    show: true
                                }
                            },
                            itemStyle: {
                                normal: {
                                    color: '#05C3F9'
                                }
                            }
                        },
                         {
                            type: 'map',
                            map: 'jiangxi',
                            geoIndex: 0,
                            aspectScale: 0.75, //长宽比
                            showLegendSymbol: false, // 存在legend时显示
                            label: {
                                normal: {
                                    show: false
                                },
                                emphasis: {
                                    show: false,
                                    textStyle: {
                                        color: '#fff'
                                    }
                                }
                            },
                            roam: true,
                            itemStyle: {
                                normal: {
                                    areaColor: '#031525',
                                    borderColor: '#3B5077',
                                },
                                emphasis: {
                                    areaColor: '#2B91B7'
                                }
                            },
                            animation: false,
                            data: data
                        },
                        {
                            name: '点',
                            type: 'scatter',
                            coordinateSystem: 'geo',
                            symbol: 'pin',
                            symbolSize: function (val) {
                                var a = (maxSize4Pin - minSize4Pin) / (max - min);
                                var b = minSize4Pin - a*min;
                                b = maxSize4Pin - a*max;
                                return 10*a*val[2]+b;
                            },
                            label: {
                                normal: {
                                    show: true,
                                    textStyle: {
                                        color: '#fff',
                                        fontSize: 9,
                                    }
                                }
                            },
                            itemStyle: {
                                normal: {
                                    color: '#F62157', //标志颜色
                                }
                            },
                            zlevel: 6,
                            data: convertData2(data),
                        },
                        {
                            name: 'Top 5',
                            type: 'effectScatter',
                            coordinateSystem: 'geo',
                            data: convertData(data.sort(function (a, b) {
                                return b.value - a.value;
                            }).slice(0, 5)),
                            symbolSize: function (val) {
                                return (val[2].qynum+val[2].jgnum+val[2].lxdnum+val[2].fwnum+val[2].cpnum) * 10;
                            },
                            showEffectOn: 'render',
                            rippleEffect: {
                                brushType: 'stroke'
                            },
                            hoverAnimation: true,
                            label: {
                                normal: {
                                    formatter: '{b}',
                                    position: 'right',
                                    show: true
                                }
                            },
                            itemStyle: {
                                normal: {
                                    color: '#05C3F9',
                                    shadowBlur: 10,
                                    shadowColor: '#05C3F9'
                                }
                            },
                            zlevel: 1
                        },
                    ]
                };

                myChart.setOption(option_map);
            });  
               
        }
    },
    error: function(result){
        alert('图表数据请求失败啦！')
    }
});  
      
   
</script>

<script type="text/javascript">
$.ajax({
    type: "POST",
    url: "{:url('datav/api/tongji')}",
    dataType:"json",
    success: function(result){
        var tongji = result['body']['data'][0]['result']['pageSum'][0];
        $('#pv').html(tongji[0]);
        $('#cv').html(tongji[1]);
        $('#uv').html(tongji[2]);
        $('#ip').html(tongji[3]);
    },
    error:function(result){
        alert('获取平台流量失败！请重试！')
    }
});
</script>





